<!DOCTYPE HTML>
<html>
<head>
    <title>Index</title>
    <script src="/src/js/filter/jquery.min.js"></script>
    <link rel='stylesheet' type='text/css' href="/src/css/filter/bootstrap.css">
    <link rel='stylesheet' type='text/css' href="/src/css/filter/style.css">
    <link rel='stylesheet' type='text/css' href="/src/css/filter/d3tip.css">
    <link rel="stylesheet" type='text/css' href="/src/css/filter/layui.css">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="keywords" content="">

    <script type="text/javascript" src="/src/js/filter/move-top.js"></script>
    <script type="text/javascript" src="/src/js/filter/easing.js"></script>

    <script src="/src/js/filter/d3.min.js"></script>
    <script src="https://unpkg.com/d3-dag@0.8.2"></script>
    <script src="/src/js/filter/d3-tip.js"></script>
    <script src="/src/js/filter/layui.js" charset="utf-8"></script>
</head>
<body>
    <div id="home" class="header" style="color: #FFFFFF">
        <div class="container" style="padding-left: 0px; margin-left: 0px;">
            <div class="top-header" style="width: 1520px; background-image: linear-gradient(#0C0C0C, #FFFFFF);">
                <div class="top-nav" style="margin-bottom: 1em;">
                    <div class="navigation">
                        <div class="logo">
                            <h1 style="color: #FFFFFF; margin-left: 50px;"><span style="color: #FFFFFF">V</span>isualization</h1>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <div class="banner-info" style="background-color: #FFFFFF; width: 1520px; margin-top: 0em;">
                    <div class="col-md-2 header-right" style="padding-left: 10px; padding-right: 0px;">
                        <h1 id="isFellow"></h1>
                        <ul class="address">
                            <li>
                                <ul class="address-text">
                                    <li style="width: 45%"><b style="color: #0C0C0C">Seq</b></li>
                                    <li style="color: coral">{{ seq }}</li>
                                </ul>
                            </li>
                            <li>
                                <ul class="address-text">
                                    <li style="width: 45%"><b style="color: #0C0C0C">Name</b></li>
                                    <li style="color: coral">{{ name }}</li>
                                </ul>
                            </li>
                            <li>
                                <ul class="address-text">
                                    <li style="width: 45%"><b style="color: #0C0C0C">paperNum</b></li>
                                    <li style="color: coral">{{ paperNum }}</li>
                                </ul>
                            </li>
                            <li>
                                <ul class="address-text">
                                    <li style="width: 45%"><b style="color: #0C0C0C">citationCount</b></li>
                                    <li style="color: coral">{{ citationCount }}</li>
                                </ul>
                            </li>
                        </ul>
                        <h1>Update</h1>
                        <form id="update_info">
                            {% csrf_token %}
                            <ul class="address"></ul>
                            <div>
                                <p style="color: #0C0C0C">mode</p>
                                <label style="color: coral; padding-right: 85px"><input type="radio" name="mode" value="1" checked="checked">Full</label>
                                <label style="color: coral"><input type="radio" name="mode" value="0">Partial</label>
                            </div>
                            <br />
                            <p style="color: #0C0C0C">isKeyPaper</p>
                            <input style="width: 70%; display: inline-block" id="range_node" type="range" name="isKeyPaper" value="0" min="0" max="1" step="0.1">
                            <span id="value_node" style="color: coral">>=0</span>
                            <script type='text/javascript'>
                                var range = document.getElementById('range_node');
                                range.onchange = function() {
                                    var value = document.getElementById('range_node').value;
                                    document.getElementById('value_node').innerHTML = ">=" + value;
                                }
                            </script>
                            <br />
                            <br />
                            <p style="color: #0C0C0C">extends_prob</p>
                            <input style="width: 70%; display: inline-block" id="range_edge" type="range" name="inheritance" value="0" min="0" max="1" step="0.1">
                            <span id="value_edge" style="color: coral">>=0</span>
                            <script type='text/javascript'>
                                var range = document.getElementById('range_edge');
                                range.onchange = function() {
                                    var value = document.getElementById('range_edge').value;
                                    document.getElementById('value_edge').innerHTML = ">=" + value;
                                }
                            </script>
                        </form>
                        <ul class="address">
                            <li>
                                <ul class="address-text">
                                    <li style="width: 25%"><b style="color: #0C0C0C">nodes</b></li>
                                    <li id="node_num" style="color: coral; width: 20%"></li>
                                    <li style="width: 25%"><b style="color: #0C0C0C">edges</b></li>
                                    <li id="edge_num" style="color: coral; width: 20%"></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-7 header-left" style="padding-left: 20px; padding-right: 20px;">
                        <!--img src="data:image/png;base64,"-->
                        <br />
                        <br />
                        <!--div>
                            <p id = "graphDetail" style="color: #00a78e"></p>
                        </div-->
                        <svg id="mainsvg" style="background-color: #FFFFFF; border-style: solid; border-color: lightsteelblue; border-width: 10px" width="850" height="440"></svg>
                        <div>
                            <br />
                            <a id="download" style="color: #0C0C0C; cursor: pointer;">If you want to download the picture, please click here.</a>
                        </div>
                    </div>
                    <div id="back" class="col-md-3 header-right" style="padding-left: 15px; padding-right: 15px;">
                        <br />
                        <div id="selector" class="btn-group btn-group-toggle" style="width: 100%" data-toggle="buttons">
                            <label class="btn btn-info" style="background-color: #00a78e; width: 50%">
                                <input type="radio" name="selector" value="info" checked="checked"> Paper Info
                            </label>
                            <label class="btn btn-info" style="background-color: #00a78e; width: 50%">
                                <input type="radio" name="selector" value="cite"> Relative Papers
                            </label>
                            <script>
                                $("input[type=radio][name=selector]").change(function () {
                                    if (this.value == "info") {
                                        $("#edge").hide();
                                        $("#line1").hide();
                                        $("#line2").hide();
                                        $("#node_form").show();
                                        $("#abstract").show();
                                    }
                                    else {
                                        $("#edge").hide();
                                        $("#node_form").hide();
                                        $("#line1").show();
                                        $("#line2").show();
                                        $("#abstract").show();
                                    }
                                });
                            </script>
                        </div>
                        <ul id="node_form" class="address">
                            <!--select id="citation_papers" class="form-select">
                                <option value="none">--请选择引用论文--</option>
                            </select-->
                            <li>
                                <ul class="address-text">
                                    <li style="width: 60%"><b style="color: #0C0C0C">paperId</b></li>
                                    <li id="paper_id" style="color: coral"></li>
                                </ul>
                                <ul class="address-text">
                                    <li style="width: 60%"><b style="color: #0C0C0C">paperName</b></li>
                                    <li id="paper_name" style="color: coral"></li>
                                </ul>
                                <ul class="address-text">
                                    <li style="width: 60%"><b style="color: #0C0C0C">publicationDate</b></li>
                                    <li id="publication_date" style="color: coral"></li>
                                </ul>
                                <ul class="address-text">
                                    <li style="width: 60%"><b style="color: #0C0C0C">citationCount</b></li>
                                    <li id="citation_count" style="color: coral"></li>
                                </ul>
                                <ul class="address-text">
                                    <li style="width: 60%"><b style="color: #0C0C0C">abstract</b></li>
                                    <div id="abstract" style="overflow: scroll; width: 100%; height: 200px; background-color: #FFFFFF; color: #0C0C0C;"></div>
                                </ul>
                            </li>
                        </ul>
                        <ul id="line1" class="address">
                            <div id="cited_papers" class="demo-tree demo-tree-box" style="width: 100%; height: 180px; overflow: scroll; background-color: #FFFFFF;"></div>
                        </ul>
                        <ul id="line2" class="address">
                            <div id="citing_papers" class="demo-tree demo-tree-box" style="width: 100%; height: 180px; overflow: scroll; background-color: #FFFFFF;"></div>
                        </ul>
                        <div id="edge">
                            <h1>Relationship</h1>
                            <ul id="source_node_form" class="address">
                                <li>
                                    <ul class="address-text">
                                        <li style="width: 60%"><b style="color: #0C0C0C">sourcePaperId</b></li>
                                        <li id="source_id" style="color: coral"></li>
                                    </ul>
                                    <ul class="address-text">
                                        <li style="width: 60%"><b style="color: #0C0C0C">paperName</b></li>
                                        <li id="source_paper" style="color: coral"></li>
                                    </ul>
                                    <ul class="address-text">
                                        <li style="width: 60%"><b style="color: #0C0C0C">publicationDate</b></li>
                                        <li id="source_pub" style="color: coral"></li>
                                    </ul>
                                    <ul class="address-text">
                                        <li style="width: 60%"><b style="color: #0C0C0C">citationCount</b></li>
                                        <li id="source_citation" style="color: coral"></li>
                                    </ul>
                                </li>
                            </ul>
                            <ul id="target_node_form" class="address">
                                <li>
                                    <ul class="address-text">
                                        <li style="width: 60%"><b style="color: #0C0C0C">targetPaperId</b></li>
                                        <li id="target_id" style="color: coral"></li>
                                    </ul>
                                    <ul class="address-text">
                                        <li style="width: 60%"><b style="color: #0C0C0C">paperName</b></li>
                                        <li id="target_paper" style="color: coral"></li>
                                    </ul>
                                    <ul class="address-text">
                                        <li style="width: 60%"><b style="color: #0C0C0C">referenceDesc</b></li>
                                        <li id="target_refer" style="color: coral"></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div id="front" class="col-md-3" style="height: 550px; padding-left: 50px; overflow: scroll;">
                        <ul id="timeline" class="timeline">
                            <li>
                                <div class="timeline-badge info"><i class="glyphicon glyphicon-briefcase"></i></div>
                                <div class="timeline-panel">
                                    <div class="timeline-heading">
                                        <h4 class="timeline-title">COMPANY NAME</h4>
                                    </div>
                                    <div class="timeline-body">
                                        <p>Lorem ipsum dolor sit amet.Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus </p>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>

    <!--初始界面-->
    <script type="text/javascript">
        $("#edge").hide();
        $("#line1").hide();
        $("#line2").hide();
        $("#abstract").hide();
        $("#back").hide();
        const paper_shown = {{ paper_shown|safe }};
        for (var i = 0; i < paper_shown.length; i++) {
            var paper_id = String(paper_shown[i][0]);
            var paper_name = String(paper_shown[i][1]);
            var li = "<li><div class=\"timeline-badge info\"><i class=\"glyphicon glyphicon-briefcase\"></i></div><div class=\"timeline-panel\"><div class=\"timeline-heading\"><h4 class=\"timeline-title\">"+paper_id+"</h4></div><div class=\"timeline-body\"><p>"+paper_name+"</p></div></div></li>";
            $("#timeline").append(li);
        }
        var seq = {{ seq|safe }};
        var filename = '/src/json/' + String(seq) + '_1_0_0.json';
        d3.json(filename).then( data => {
            const data1 = data[0];  //椭圆
            const data2 = data[1];  //path
            const data0 = data[2];  //文本
            const data5 = data[3];  //箭头
            const params = {{ params|safe }};
            const width = params[0];
            const height = params[1];
            const nodes = params[2];
            const edges = params[3];
            $('#node_num').text(nodes);
            $('#edge_num').text(edges);
            const isFellow = params[4];
            if (isFellow == 1) {
                $('#isFellow').text("Basic Info (Fellow)");
            }
            else {
                $('#isFellow').text("Basic Info");
            }

            const zoom = d3.zoom()
            .scaleExtent([0.1, 10])
            .on("zoom", _ => g.attr("transform", d3.event.transform));

            const tip = d3.tip()
            .attr('class', 'd3-tip').html(function(d) { return d.name });

            const svg = d3.select('#mainsvg')
            svg.call(zoom);
            svg.call(tip);
            //const width = +svg.attr('width');
            //const height = +svg.attr('height');
            const margin = {top:20,right:60,bottom:20,left:60};
            const innerWidth = width - margin.right - margin.left;
            const innerHeight = height - margin.top - margin.bottom;

            const xScale = d3.scaleLinear()
            .domain([d3.min(data1, d => d.cx), d3.max(data1, d => d.cx)])
            .range([0, innerWidth]);

            const yScale = d3.scaleLinear()
            .domain([d3.min(data1, d => d.cy), d3.max(data1, d => d.cy)])
            .range([0, innerHeight]);

            const g = svg.append('g').attr('id', 'maingroup')
            .attr('transform', `translate(${margin.left}, ${margin.top})`);

            const rect = g.selectAll('rect').data(data1).enter().append('rect')
            .attr('x', d => xScale(d.cx) - xScale(d.citation_count))
            .attr('y', d => yScale(d.cy) - 25)
            .attr('width', d => xScale(d.citation_count))
            .attr('height', 50)
            .attr('fill', 'steelblue')
            .attr('name', d => d.citation_count);

            const ellipse = g.selectAll('ellipse').data(data1).enter().append('ellipse')
            .attr('cx', d => xScale(d.cx))
            .attr('cy', d => yScale(d.cy))
            .attr('rx', d => Math.abs(xScale(d.rx) - xScale(0)))
            .attr('ry', d => Math.abs(yScale(d.ry) - yScale(0)))
            .attr('fill', 'white')
            .attr('stroke', d => d.stroke)
            .attr('stroke-width', d => d.width)
            .attr('stroke-dasharray', d => d.dasharray)
            .attr('id', d => d.id);

            //将线path从图片比例尺变为当前比例尺
            var data3 = [];
            data2.forEach( link => {
                data4 = link.d;
                var num = '', d = 'M';
                for (var i = 1; i < data4.length; i++) {
                    if (i == data4.length - 1) {
                        num = num + data4[i];
                        num = parseFloat(num);
                        num = yScale(num);
                        d = d + String(num);
                    }
                    else {
                        if (data4[i + 1] == ',') {
                            num = num + data4[i];
                            num = parseFloat(num);
                            num = xScale(num);
                            d = d + String(num);
                            num = '';
                        }
                        else if (data4[i + 1] == 'C' || data4[i + 1] == ' ') {
                            num = num + data4[i];
                            num = parseFloat(num);
                            num = yScale(num);
                            d = d + String(num);
                            num = '';
                        }
                        else if (data4[i] == ',' || data4[i] == 'C' || data4[i] == ' ') {
                            d = d + data4[i];
                        }
                        else {
                            num = num + data4[i];
                        }
                    }
                }
                var dict = new Array();
                dict['source'] = link.source;
                dict['target'] = link.target;
                dict['d'] = d;
                data3.push(dict);
            })

            const lines = g.selectAll('path').data(data3).enter().append('path')
            .attr('fill', 'none')
            .attr('stroke', 'black')
            .attr('stroke-width', 3)
            .attr('d', d => d.d)
            .attr('id', d => d.source + '->' + d.target);

            //将箭头polygon从图片比例尺变为当前比例尺
            var data6 = [];
            data5.forEach( d => {
                var num = '', polygon_d = '';
                for (var i = 0; i < d.length; i++) {
                    if (d[i + 1] == ',') {
                        num = num + d[i];
                        num = parseFloat(num);
                        num = xScale(num);
                        polygon_d = polygon_d + String(num);
                        num = '';
                    }
                    else if (d[i + 1] == ' ' || i + 1 == d.length) {
                        num = num + d[i];
                        num = parseFloat(num);
                        num = yScale(num);
                        polygon_d = polygon_d + String(num);
                        num = '';
                    }
                    else if (d[i] == ',' || d[i] == ' ') {
                        polygon_d = polygon_d + d[i];
                    }
                    else {
                        num = num + d[i];
                    }
                }
                data6.push(polygon_d);
            })

            g.selectAll('polygon').data(data6).enter().append('polygon')
            .attr('fill', 'black')
            .attr('stroke', 'black')
            .attr('points', d => d);

            g.selectAll('text').data(data0).enter().append('text')
            .attr('x', d => xScale(d.x))
            .attr('y', d => yScale(d.y))
            .text(d => d.name)
            .attr('text-anchor', 'middle')
            .attr('font-family', 'Times New Roman,serif')
            .attr('font-size', 14);

            rect
            .on('mouseover', function (d) {
                d3.select(this).attr("fill", "lightsteelblue")
                .attr('cursor', 'pointer');
                tip.show(d);
            })
            .on('mouseout', function (d) {
                d3.selectAll('rect').attr('fill', 'steelblue');
                tip.hide(d);
            });

            ellipse
            .on('mouseover', function (d) {
                d3.select(this).attr('cursor', 'pointer');
                tip.show(d);
            })
            .on('click', function () {
                //先将其复原
                d3.selectAll('path')
                .attr('stroke', 'black')
                .attr('stroke-width', 3);
                d3.selectAll('ellipse').attr('fill', 'white');

                var id = d3.select(this).attr('id');
                var sourceGroup = [];
                d3.selectAll('path')
                .attr('stroke', function (d) {
                    if (d.target == id) {
                        sourceGroup.push(d.source);
                        return 'red';
                    }
                    else {
                        return 'black';
                    }
                })
                .attr('stroke-width', function (d) {
                    if (d.target == id) {
                        return '10';
                    }
                    else {
                        return '3';
                    }
                });
                d3.selectAll('ellipse').attr('fill', function (d) {
                    var flag = 0;
                    for (var i = 0; i < sourceGroup.length; i++) {
                        if (sourceGroup[i] == d.id) {
                            flag = 1;
                            break;
                        }
                    }
                    if (flag || d.id == id) {
                        return 'lightsteelblue';
                    }
                    else {
                        return 'white';
                    }
                });

                $("#front").hide();
                $("#back").show();
                $("#edge").hide();
                $("#line1").hide();
                $("#line2").hide();
                $("#selector").show();
                $("#node_form").show();
                $("#abstract").show();
                for (var i = 0; i < data1.length; i++) {
                    if (data1[i].id == id) {
                        $('#paper_id').text(data1[i].id);
                        $('#paper_name').text(data1[i].name);
                        $('#publication_date').text(data1[i].publication_data);
                        $('#citation_count').text(data1[i].citation);
                        $('#abstract').text(data1[i].abstract);
                        /*$("#citation_papers").empty();
                        $("#citation_papers").append("<option value=\"none\">--请选择引用论文--</option>");
                        for (var j = 0; j < sourceGroup.length; j++) {
                            var paper = "<option value='"+sourceGroup[j]+"'>"+sourceGroup[j]+"</option>";
                            $("#citation_papers").append(paper);
                        }
                        break;*/
                    }
                }

                var citedTraversal = function (root) {
                    var self_dict = {};
                    self_dict["title"] = root;
                    self_dict["children"] = [];
                    var flag = 0;
                    for (var i = 0; i < data2.length; i++) {
                        if (root == data2[i]['target']) {
                            flag = 1;
                            self_dict["children"].push(citedTraversal(data2[i]['source']));
                        }
                    }
                    if (flag == 0) {
                        delete self_dict["children"];
                    }
                    return self_dict;
                }
                var citingTraversal = function (root) {
                    var self_dict = {};
                    self_dict["title"] = root;
                    self_dict["children"] = [];
                    var flag = 0;
                    for (var i = 0; i < data2.length; i++) {
                        if (root == data2[i]['source']) {
                            flag = 1;
                            self_dict["children"].push(citingTraversal(data2[i]['target']));
                        }
                    }
                    if (flag == 0) {
                        delete self_dict["children"];
                    }
                    return self_dict;
                }
                var cited_list = [];
                cited_list.push(citedTraversal(id));
                var citing_list = [];
                citing_list.push(citingTraversal(id));
                layui.use(['tree', 'util'], function(){
                    var tree = layui.tree,
                    layer = layui.layer,
                    data = cited_list
                    tree.render({
                        elem: '#cited_papers', //默认是点击节点可进行收缩
                        data: data
                    });
                });
                layui.use(['tree', 'util'], function(){
                    var tree = layui.tree,
                    layer = layui.layer,
                    data = citing_list
                    tree.render({
                        elem: '#citing_papers',
                        data: data,
                    });
                });

            })
            .on('mouseout', function (d) {
                tip.hide(d);
            });

            lines
            .on('mouseover', function () {
                d3.selectAll('path')
                .attr('stroke', 'black')
                .attr('stroke-width', 3);
                d3.select(this)
                .attr("stroke", "red")
                .attr("stroke-width", 5)
                .attr('cursor', 'pointer');
            })
            .on('click', function () {
                var id = d3.select(this).attr('id');
                var source = '', target = '';
                var flag = 0;
                //得到source_node的id
                for (var i = 0; i < id.length; i++) {
                    if (id[i] == '-' && id[i+1] == '>') {
                        flag = i;
                        break;
                    }
                    else {
                        source += id[i];
                    }
                }
                //得到target_node的id
                for (var i = flag + 2; i < id.length; i++) {
                    target += id[i];
                }

                //对source_node和target_node染色
                d3.selectAll('ellipse')
                .attr('fill', function (d) {
                    if (d.id == source || d.id == target) {
                        return 'lightsteelblue';
                    }
                    else {
                        return 'white';
                    }
                })
                .attr('cursor', 'pointer');

                $("#front").hide();
                $("#back").show();
                $("#selector").hide();
                $("#node_form").hide();
                $("#line1").hide();
                $("#line2").hide();
                $("#edge").show();
                for (var i = 0; i < data1.length; i++) {
                    if (data1[i].id == source) {
                        $('#source_id').text(data1[i].id);
                        $('#source_paper').text(data1[i].name);
                        $('#source_pub').text(data1[i].publication_data);
                        $('#source_citation').text(data1[i].citation);
                    }
                    if (data1[i].id == target) {
                        $('#target_id').text(data1[i].id);
                        $('#target_paper').text(data1[i].name);
                        $('#target_refer').text("目前暂无");
                    }
                }
            });

            /*$("#citation_papers").bind("change", function () {
                //先将其复原
                d3.selectAll('path')
                .attr('stroke', 'black')
                .attr('stroke-width', 3);
                d3.selectAll('ellipse').attr('fill', 'white');

                var option = $("#citation_papers option:selected");
                var id = option.val();
                console.log(id);

                var sourceGroup = [];
                d3.selectAll('path')
                .attr('stroke', function (d) {
                    if (d.target == id) {
                        sourceGroup.push(d.source);
                        return 'red';
                    }
                    else {
                        return 'black';
                    }
                })
                .attr('stroke-width', function (d) {
                    if (d.target == id) {
                        return '10';
                    }
                    else {
                        return '3';
                    }
                });
                d3.selectAll('ellipse').attr('fill', function (d) {
                    var flag = 0;
                    for (var i = 0; i < sourceGroup.length; i++) {
                        if (sourceGroup[i] == d.id) {
                            flag = 1;
                            break;
                        }
                    }
                    if (flag || d.id == id) {
                        return 'lightsteelblue';
                    }
                    else {
                        return 'white';
                    }
                });

                for (var i = 0; i < data1.length; i++) {
                    if (data1[i].id == id) {
                        $('#paper_id').text(data1[i].id);
                        $('#paper_name').text(data1[i].name);
                        $('#publication').text(data1[i].publication_data);
                        $('#citation').text(data1[i].citation);
                        $("#citation_papers").empty();
                        $("#citation_papers").append("<option value=\"none\">--请选择引用论文--</option>");
                        d3.selectAll('path').each(d => {
                            if (d.target == id) {
                                var paper = "<option value='"+d.source+"'>"+d.source+"</option>";
                                $("#citation_papers").append(paper);
                            }
                        });
                        break;
                    }
                }
            });*/
        });
    </script>

    <!--ajax提交表单-->
    <script type="text/javascript">
        $(function() {
            function getCookie(name) {
                var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");
                return r ? r[1] : undefined;
            }
            $("#update_info :radio").click(function() {
                $.ajax({
                    headers: {"X-CSRFToken": getCookie("csrftoken")},
                    type: "POST",
                    dataType: "json",
                    url: "/update/",
                    data: $("#update_info").serialize(),
                    success: function (params) {
                        $('#mainsvg').empty();
                        d3.tip().destroy();
                        $("#edge").hide();
                        $("#line1").hide();
                        $("#line2").hide();
                        $("#abstract").hide();
                        $([name="selector"]).show();
                        $("#node_form").show();
                        $("#paper_id").empty();
                        $("#paper_name").empty();
                        $("#publication_date").empty();
                        $("#citation_count").empty();
                        $("#back").hide();
                        $("#timeline").empty();
                        const paper_shown = params['paper_shown'];
                        for (var i = 0; i < paper_shown.length; i++) {
                            var paper_id = String(paper_shown[i][0]);
                            var paper_name = String(paper_shown[i][1]);
                            var li = "<li><div class=\"timeline-badge info\"><i class=\"glyphicon glyphicon-briefcase\"></i></div><div class=\"timeline-panel\"><div class=\"timeline-heading\"><h4 class=\"timeline-title\">"+paper_id+"</h4></div><div class=\"timeline-body\"><p>"+paper_name+"</p></div></div></li>";
                            $("#timeline").append(li);
                        }
                        $("#front").show();
                        var detail = params['detail'];
                        var filename = '/src/json/' + detail + '.json';
                        d3.json(filename).then( data => {
                            const data1 = data[0];
                            const data2 = data[1];
                            const data0 = data[2];
                            const data5 = data[3];
                            const param = params['param'];
                            const width = param[0];
                            const height = param[1];
                            const nodes = param[2];
                            const edges = param[3];
                            $('#node_num').text(nodes);
                            $('#edge_num').text(edges);

                            const zoom = d3.zoom()
                            .scaleExtent([0.1, 10])
                            .on("zoom", _ => g.attr("transform", d3.event.transform));

                            const tip = d3.tip()
                            .attr('class', 'd3-tip').html(function(d) { return d.name });

                            const svg = d3.select('#mainsvg');
                            svg.call(zoom);
                            svg.call(tip);
                            const margin = {top:20,right:60,bottom:20,left:60};
                            const innerWidth = width - margin.right - margin.left;
                            const innerHeight = height - margin.top - margin.bottom;

                            const xScale = d3.scaleLinear()
                            .domain([d3.min(data1, d => d.cx), d3.max(data1, d => d.cx)])
                            .range([0, innerWidth]);

                            const yScale = d3.scaleLinear()
                            .domain([d3.min(data1, d => d.cy), d3.max(data1, d => d.cy)])
                            .range([0, innerHeight]);

                            const g = svg.append('g').attr('id', 'maingroup')
                            .attr('transform', `translate(${margin.left}, ${margin.top})`);

                            const rect = g.selectAll('rect').data(data1).enter().append('rect')
                            .attr('x', d => xScale(d.cx) - xScale(d.citation_count))
                            .attr('y', d => yScale(d.cy) - 25)
                            .attr('width', d => xScale(d.citation_count))
                            .attr('height', 50)
                            .attr('fill', 'steelblue')
                            .attr('name', d => d.citation_count);

                            const ellipse = g.selectAll('ellipse').data(data1).enter().append('ellipse')
                            .attr('cx', d => xScale(d.cx))
                            .attr('cy', d => yScale(d.cy))
                            .attr('rx', d => Math.abs(xScale(d.rx) - xScale(0)))
                            .attr('ry', d => Math.abs(yScale(d.ry) - yScale(0)))
                            .attr('fill', 'white')
                            .attr('stroke', d => d.stroke)
                            .attr('stroke-width', d => d.width)
                            .attr('stroke-dasharray', d => d.dasharray)
                            .attr('id', d => d.id);

                            var data3 = [];
                            data2.forEach( link => {
                                data4 = link.d;
                                var num = '', d = 'M';
                                for (var i = 1; i < data4.length; i++) {
                                    if (i == data4.length - 1) {
                                        num = num + data4[i];
                                        num = parseFloat(num);
                                        num = yScale(num);
                                        d = d + String(num);
                                    }
                                    else {
                                        if (data4[i + 1] == ',') {
                                            num = num + data4[i];
                                            num = parseFloat(num);
                                            num = xScale(num);
                                            d = d + String(num);
                                            num = '';
                                        }
                                        else if (data4[i + 1] == 'C' || data4[i + 1] == ' ') {
                                            num = num + data4[i];
                                            num = parseFloat(num);
                                            num = yScale(num);
                                            d = d + String(num);
                                            num = '';
                                        }
                                        else if (data4[i] == ',' || data4[i] == 'C' || data4[i] == ' ') {
                                            d = d + data4[i];
                                        }
                                        else {
                                            num = num + data4[i];
                                        }
                                    }
                                }
                                var dict = new Array();
                                dict['source'] = link.source;
                                dict['target'] = link.target;
                                dict['d'] = d;
                                data3.push(dict);
                            })

                            const lines = g.selectAll('path').data(data3).enter().append('path')
                            .attr('fill', 'none')
                            .attr('stroke', 'black')
                            .attr('d', d => d.d)
                            .attr('id', d => d.source + '->' + d.target);

                            var data6 = [];
                            data5.forEach( d => {
                                var num = '', polygon_d = '';
                                for (var i = 0; i < d.length; i++) {
                                    if (d[i + 1] == ',') {
                                        num = num + d[i];
                                        num = parseFloat(num);
                                        num = xScale(num);
                                        polygon_d = polygon_d + String(num);
                                        num = '';
                                    }
                                    else if (d[i + 1] == ' ' || i + 1 == d.length) {
                                        num = num + d[i];
                                        num = parseFloat(num);
                                        num = yScale(num);
                                        polygon_d = polygon_d + String(num);
                                        num = '';
                                    }
                                    else if (d[i] == ',' || d[i] == ' ') {
                                        polygon_d = polygon_d + d[i];
                                    }
                                    else {
                                        num = num + d[i];
                                    }
                                }
                                data6.push(polygon_d);
                            })

                            g.selectAll('polygon').data(data6).enter().append('polygon')
                            .attr('fill', 'black')
                            .attr('stroke', 'black')
                            .attr('points', d => d);

                            g.selectAll('text').data(data0).enter().append('text')
                            .attr('x', d => xScale(d.x))
                            .attr('y', d => yScale(d.y))
                            .text(d => d.name)
                            .attr('text-anchor', 'middle')
                            .attr('font-family', 'Times New Roman,serif')
                            .attr('font-size', 14);

                            rect
                            .on('mouseover', function (d) {
                                d3.select(this).attr("fill", "lightsteelblue")
                                .attr('cursor', 'pointer');
                                tip.show(d);
                            })
                            .on('mouseout', function (d) {
                                d3.selectAll('rect').attr('fill', 'steelblue');
                                tip.hide(d);
                            });

                            ellipse
                            .on('mouseover', function (d) {
                                d3.select(this).attr('cursor', 'pointer');
                                tip.show(d);
                            })
                            .on('click', function () {
                                //先将其复原
                                d3.selectAll('path')
                                .attr('stroke', 'black')
                                .attr('stroke-width', 3);
                                d3.selectAll('ellipse').attr('fill', 'white');

                                var id = d3.select(this).attr('id');
                                var sourceGroup = [];
                                d3.selectAll('path')
                                .attr('stroke', function (d) {
                                    if (d.target == id) {
                                        sourceGroup.push(d.source);
                                        return 'red';
                                    }
                                    else {
                                        return 'black';
                                    }
                                })
                                .attr('stroke-width', function (d) {
                                    if (d.target == id) {
                                        return '10';
                                    }
                                    else {
                                        return '3';
                                    }
                                });
                                d3.selectAll('ellipse').attr('fill', function (d) {
                                    var flag = 0;
                                    for (var i = 0; i < sourceGroup.length; i++) {
                                        if (sourceGroup[i] == d.id) {
                                            flag = 1;
                                            break;
                                        }
                                    }
                                    if (flag || d.id == id) {
                                        return 'lightsteelblue';
                                    }
                                    else {
                                        return 'white';
                                    }
                                });

                                $("#front").hide();
                                $("#back").show();
                                $("#edge").hide();
                                $("#line1").hide();
                                $("#line2").hide();
                                $("#selector").show();
                                $("#node_form").show();
                                $("#abstract").show();
                                for (var i = 0; i < data1.length; i++) {
                                    if (data1[i].id == id) {
                                        $('#paper_id').text(data1[i].id);
                                        $('#paper_name').text(data1[i].name);
                                        $('#publication_date').text(data1[i].publication_data);
                                        $('#citation_count').text(data1[i].citation);
                                        $('#abstract').text(data1[i].abstract);
                                        /*$("#citation_papers").empty();
                                        $("#citation_papers").append("<option value=\"none\">--请选择引用论文--</option>");
                                        for (var j = 0; j < sourceGroup.length; j++) {
                                            var paper = "<option value='"+sourceGroup[j]+"'>"+sourceGroup[j]+"</option>";
                                            $("#citation_papers").append(paper);
                                        }
                                        break;*/
                                    }
                                }

                                var citedTraversal = function (root) {
                                    var self_dict = {};
                                    self_dict["title"] = root;
                                    self_dict["children"] = [];
                                    var flag = 0;
                                    for (var i = 0; i < data2.length; i++) {
                                        if (root == data2[i]['target']) {
                                            flag = 1;
                                            self_dict["children"].push(citedTraversal(data2[i]['source']));
                                        }
                                    }
                                    if (flag == 0) {
                                        delete self_dict["children"];
                                    }
                                    return self_dict;
                                }
                                var citingTraversal = function (root) {
                                    var self_dict = {};
                                    self_dict["title"] = root;
                                    self_dict["children"] = [];
                                    var flag = 0;
                                    for (var i = 0; i < data2.length; i++) {
                                        if (root == data2[i]['source']) {
                                            flag = 1;
                                            self_dict["children"].push(citingTraversal(data2[i]['target']));
                                        }
                                    }
                                    if (flag == 0) {
                                        delete self_dict["children"];
                                    }
                                    return self_dict;
                                }
                                var cited_list = [];
                                cited_list.push(citedTraversal(id));
                                var citing_list = [];
                                citing_list.push(citingTraversal(id));
                                layui.use(['tree', 'util'], function(){
                                    var tree = layui.tree,
                                    layer = layui.layer,
                                    data = cited_list
                                    tree.render({
                                        elem: '#cited_papers', //默认是点击节点可进行收缩
                                        data: data
                                    });
                                });
                                layui.use(['tree', 'util'], function(){
                                    var tree = layui.tree,
                                    layer = layui.layer,
                                    data = citing_list
                                    tree.render({
                                        elem: '#citing_papers',
                                        data: data,
                                    });
                                });

                            })
                            .on('mouseout', function (d) {
                                tip.hide(d);
                            });

                            lines
                            .on('mouseover', function () {
                                d3.selectAll('path')
                                .attr('stroke', 'black')
                                .attr('stroke-width', 3);
                                d3.select(this)
                                .attr("stroke", "red")
                                .attr("stroke-width", 5)
                                .attr('cursor', 'pointer');
                            })
                            .on('click', function () {
                                var id = d3.select(this).attr('id');
                                var source = '', target = '';
                                var flag = 0;
                                //得到source_node的id
                                for (var i = 0; i < id.length; i++) {
                                    if (id[i] == '-' && id[i+1] == '>') {
                                        flag = i;
                                        break;
                                    }
                                    else {
                                        source += id[i];
                                    }
                                }
                                //得到target_node的id
                                for (var i = flag + 2; i < id.length; i++) {
                                    target += id[i];
                                }

                                //对source_node和target_node染色
                                d3.selectAll('ellipse')
                                .attr('fill', function (d) {
                                    if (d.id == source || d.id == target) {
                                        return 'lightsteelblue';
                                    }
                                    else {
                                        return 'white';
                                    }
                                })
                                .attr('cursor', 'pointer');

                                $("#front").hide();
                                $("#back").show();
                                $("#selector").hide();
                                $("#node_form").hide();
                                $("#line1").hide();
                                $("#line2").hide();
                                $("#edge").show();
                                for (var i = 0; i < data1.length; i++) {
                                    if (data1[i].id == source) {
                                        $('#source_id').text(data1[i].id);
                                        $('#source_paper').text(data1[i].name);
                                        $('#source_pub').text(data1[i].publication_data);
                                        $('#source_citation').text(data1[i].citation);
                                    }
                                    if (data1[i].id == target) {
                                        $('#target_id').text(data1[i].id);
                                        $('#target_paper').text(data1[i].name);
                                        $('#target_refer').text("目前暂无");
                                    }
                                }
                            });
                        });
                    },
                });
            });
            $("#range_node, #range_edge").change(function() {
                $.ajax({
                    headers: {"X-CSRFToken": getCookie("csrftoken")},
                    type: "POST",
                    dataType: "json",
                    url: "/update/",
                    data: $("#update_info").serialize(),
                    success: function (params) {
                        $('#mainsvg').empty();
                        d3.tip().destroy();
                        $("#edge").hide();
                        $("#line1").hide();
                        $("#line2").hide();
                        $("#abstract").hide();
                        $([name="selector"]).show();
                        $("#node_form").show();
                        $("#paper_id").empty();
                        $("#paper_name").empty();
                        $("#publication_date").empty();
                        $("#citation_count").empty();
                        $("#back").hide();
                        $("#timeline").empty();
                        const paper_shown = params['paper_shown'];
                        for (var i = 0; i < paper_shown.length; i++) {
                            var paper_id = String(paper_shown[i][0]);
                            var paper_name = String(paper_shown[i][1]);
                            var li = "<li><div class=\"timeline-badge info\"><i class=\"glyphicon glyphicon-briefcase\"></i></div><div class=\"timeline-panel\"><div class=\"timeline-heading\"><h4 class=\"timeline-title\">"+paper_id+"</h4></div><div class=\"timeline-body\"><p>"+paper_name+"</p></div></div></li>";
                            $("#timeline").append(li);
                        }
                        $("#front").show();
                        var detail = params['detail'];
                        var filename = '/src/json/' + detail + '.json';
                        d3.json(filename).then( data => {
                            const data1 = data[0];
                            const data2 = data[1];
                            const data0 = data[2];
                            const data5 = data[3];
                            const param = params['param'];
                            const width = param[0];
                            const height = param[1];
                            const nodes = param[2];
                            const edges = param[3];
                            $('#node_num').text(nodes);
                            $('#edge_num').text(edges);

                            const zoom = d3.zoom()
                            .scaleExtent([0.1, 10])
                            .on("zoom", _ => g.attr("transform", d3.event.transform));

                            const tip = d3.tip()
                            .attr('class', 'd3-tip').html(function(d) { return d.name });

                            const svg = d3.select('#mainsvg');
                            svg.call(zoom);
                            svg.call(tip);
                            const margin = {top:20,right:60,bottom:20,left:60};
                            const innerWidth = width - margin.right - margin.left;
                            const innerHeight = height - margin.top - margin.bottom;

                            const xScale = d3.scaleLinear()
                            .domain([d3.min(data1, d => d.cx), d3.max(data1, d => d.cx)])
                            .range([0, innerWidth]);

                            const yScale = d3.scaleLinear()
                            .domain([d3.min(data1, d => d.cy), d3.max(data1, d => d.cy)])
                            .range([0, innerHeight]);

                            const g = svg.append('g').attr('id', 'maingroup')
                            .attr('transform', `translate(${margin.left}, ${margin.top})`);

                            const rect = g.selectAll('rect').data(data1).enter().append('rect')
                            .attr('x', d => xScale(d.cx) - xScale(d.citation_count))
                            .attr('y', d => yScale(d.cy) - 25)
                            .attr('width', d => xScale(d.citation_count))
                            .attr('height', 50)
                            .attr('fill', 'steelblue')
                            .attr('name', d => d.citation_count);

                            const ellipse = g.selectAll('ellipse').data(data1).enter().append('ellipse')
                            .attr('cx', d => xScale(d.cx))
                            .attr('cy', d => yScale(d.cy))
                            .attr('rx', d => Math.abs(xScale(d.rx) - xScale(0)))
                            .attr('ry', d => Math.abs(yScale(d.ry) - yScale(0)))
                            .attr('fill', 'white')
                            .attr('stroke', d => d.stroke)
                            .attr('stroke-width', d => d.width)
                            .attr('stroke-dasharray', d => d.dasharray)
                            .attr('id', d => d.id);

                            var data3 = [];
                            data2.forEach( link => {
                                data4 = link.d;
                                var num = '', d = 'M';
                                for (var i = 1; i < data4.length; i++) {
                                    if (i == data4.length - 1) {
                                        num = num + data4[i];
                                        num = parseFloat(num);
                                        num = yScale(num);
                                        d = d + String(num);
                                    }
                                    else {
                                        if (data4[i + 1] == ',') {
                                            num = num + data4[i];
                                            num = parseFloat(num);
                                            num = xScale(num);
                                            d = d + String(num);
                                            num = '';
                                        }
                                        else if (data4[i + 1] == 'C' || data4[i + 1] == ' ') {
                                            num = num + data4[i];
                                            num = parseFloat(num);
                                            num = yScale(num);
                                            d = d + String(num);
                                            num = '';
                                        }
                                        else if (data4[i] == ',' || data4[i] == 'C' || data4[i] == ' ') {
                                            d = d + data4[i];
                                        }
                                        else {
                                            num = num + data4[i];
                                        }
                                    }
                                }
                                var dict = new Array();
                                dict['source'] = link.source;
                                dict['target'] = link.target;
                                dict['d'] = d;
                                data3.push(dict);
                            })

                            const lines = g.selectAll('path').data(data3).enter().append('path')
                            .attr('fill', 'none')
                            .attr('stroke', 'black')
                            .attr('d', d => d.d)
                            .attr('id', d => d.source + '->' + d.target);

                            var data6 = [];
                            data5.forEach( d => {
                                var num = '', polygon_d = '';
                                for (var i = 0; i < d.length; i++) {
                                    if (d[i + 1] == ',') {
                                        num = num + d[i];
                                        num = parseFloat(num);
                                        num = xScale(num);
                                        polygon_d = polygon_d + String(num);
                                        num = '';
                                    }
                                    else if (d[i + 1] == ' ' || i + 1 == d.length) {
                                        num = num + d[i];
                                        num = parseFloat(num);
                                        num = yScale(num);
                                        polygon_d = polygon_d + String(num);
                                        num = '';
                                    }
                                    else if (d[i] == ',' || d[i] == ' ') {
                                        polygon_d = polygon_d + d[i];
                                    }
                                    else {
                                        num = num + d[i];
                                    }
                                }
                                data6.push(polygon_d);
                            })

                            g.selectAll('polygon').data(data6).enter().append('polygon')
                            .attr('fill', 'black')
                            .attr('stroke', 'black')
                            .attr('points', d => d);

                            g.selectAll('text').data(data0).enter().append('text')
                            .attr('x', d => xScale(d.x))
                            .attr('y', d => yScale(d.y))
                            .text(d => d.name)
                            .attr('text-anchor', 'middle')
                            .attr('font-family', 'Times New Roman,serif')
                            .attr('font-size', 14);

                            rect
                            .on('mouseover', function (d) {
                                d3.select(this).attr("fill", "lightsteelblue")
                                .attr('cursor', 'pointer');
                                tip.show(d);
                            })
                            .on('mouseout', function (d) {
                                d3.selectAll('rect').attr('fill', 'steelblue');
                                tip.hide(d);
                            });

                            ellipse
                            .on('mouseover', function (d) {
                                d3.select(this).attr('cursor', 'pointer');
                                tip.show(d);
                            })
                            .on('click', function () {
                                //先将其复原
                                d3.selectAll('path')
                                .attr('stroke', 'black')
                                .attr('stroke-width', 3);
                                d3.selectAll('ellipse').attr('fill', 'white');

                                var id = d3.select(this).attr('id');
                                var sourceGroup = [];
                                d3.selectAll('path')
                                .attr('stroke', function (d) {
                                    if (d.target == id) {
                                        sourceGroup.push(d.source);
                                        return 'red';
                                    }
                                    else {
                                        return 'black';
                                    }
                                })
                                .attr('stroke-width', function (d) {
                                    if (d.target == id) {
                                        return '10';
                                    }
                                    else {
                                        return '3';
                                    }
                                });
                                d3.selectAll('ellipse').attr('fill', function (d) {
                                    var flag = 0;
                                    for (var i = 0; i < sourceGroup.length; i++) {
                                        if (sourceGroup[i] == d.id) {
                                            flag = 1;
                                            break;
                                        }
                                    }
                                    if (flag || d.id == id) {
                                        return 'lightsteelblue';
                                    }
                                    else {
                                        return 'white';
                                    }
                                });

                                $("#front").hide();
                                $("#back").show();
                                $("#edge").hide();
                                $("#line1").hide();
                                $("#line2").hide();
                                $("#selector").show();
                                $("#node_form").show();
                                $("#abstract").show();
                                for (var i = 0; i < data1.length; i++) {
                                    if (data1[i].id == id) {
                                        $('#paper_id').text(data1[i].id);
                                        $('#paper_name').text(data1[i].name);
                                        $('#publication_date').text(data1[i].publication_data);
                                        $('#citation_count').text(data1[i].citation);
                                        $('#abstract').text(data1[i].abstract);
                                        /*$("#citation_papers").empty();
                                        $("#citation_papers").append("<option value=\"none\">--请选择引用论文--</option>");
                                        for (var j = 0; j < sourceGroup.length; j++) {
                                            var paper = "<option value='"+sourceGroup[j]+"'>"+sourceGroup[j]+"</option>";
                                            $("#citation_papers").append(paper);
                                        }
                                        break;*/
                                    }
                                }

                                var citedTraversal = function (root) {
                                    var self_dict = {};
                                    self_dict["title"] = root;
                                    self_dict["children"] = [];
                                    var flag = 0;
                                    for (var i = 0; i < data2.length; i++) {
                                        if (root == data2[i]['target']) {
                                            flag = 1;
                                            self_dict["children"].push(citedTraversal(data2[i]['source']));
                                        }
                                    }
                                    if (flag == 0) {
                                        delete self_dict["children"];
                                    }
                                    return self_dict;
                                }
                                var citingTraversal = function (root) {
                                    var self_dict = {};
                                    self_dict["title"] = root;
                                    self_dict["children"] = [];
                                    var flag = 0;
                                    for (var i = 0; i < data2.length; i++) {
                                        if (root == data2[i]['source']) {
                                            flag = 1;
                                            self_dict["children"].push(citingTraversal(data2[i]['target']));
                                        }
                                    }
                                    if (flag == 0) {
                                        delete self_dict["children"];
                                    }
                                    return self_dict;
                                }
                                var cited_list = [];
                                cited_list.push(citedTraversal(id));
                                var citing_list = [];
                                citing_list.push(citingTraversal(id));
                                layui.use(['tree', 'util'], function(){
                                    var tree = layui.tree,
                                    layer = layui.layer,
                                    data = cited_list
                                    tree.render({
                                        elem: '#cited_papers', //默认是点击节点可进行收缩
                                        data: data
                                    });
                                });
                                layui.use(['tree', 'util'], function(){
                                    var tree = layui.tree,
                                    layer = layui.layer,
                                    data = citing_list
                                    tree.render({
                                        elem: '#citing_papers',
                                        data: data,
                                    });
                                });

                            })
                            .on('mouseout', function (d) {
                                tip.hide(d);
                            });

                            lines
                            .on('mouseover', function () {
                                d3.selectAll('path')
                                .attr('stroke', 'black')
                                .attr('stroke-width', 3);
                                d3.select(this)
                                .attr("stroke", "red")
                                .attr("stroke-width", 5)
                                .attr('cursor', 'pointer');
                            })
                            .on('click', function () {
                                var id = d3.select(this).attr('id');
                                var source = '', target = '';
                                var flag = 0;
                                //得到source_node的id
                                for (var i = 0; i < id.length; i++) {
                                    if (id[i] == '-' && id[i+1] == '>') {
                                        flag = i;
                                        break;
                                    }
                                    else {
                                        source += id[i];
                                    }
                                }
                                //得到target_node的id
                                for (var i = flag + 2; i < id.length; i++) {
                                    target += id[i];
                                }

                                //对source_node和target_node染色
                                d3.selectAll('ellipse')
                                .attr('fill', function (d) {
                                    if (d.id == source || d.id == target) {
                                        return 'lightsteelblue';
                                    }
                                    else {
                                        return 'white';
                                    }
                                })
                                .attr('cursor', 'pointer');

                                $("#front").hide();
                                $("#back").show();
                                $("#selector").hide();
                                $("#node_form").hide();
                                $("#line1").hide();
                                $("#line2").hide();
                                $("#edge").show();
                                for (var i = 0; i < data1.length; i++) {
                                    if (data1[i].id == source) {
                                        $('#source_id').text(data1[i].id);
                                        $('#source_paper').text(data1[i].name);
                                        $('#source_pub').text(data1[i].publication_data);
                                        $('#source_citation').text(data1[i].citation);
                                    }
                                    if (data1[i].id == target) {
                                        $('#target_id').text(data1[i].id);
                                        $('#target_paper').text(data1[i].name);
                                        $('#target_refer').text("目前暂无");
                                    }
                                }
                            });
                        });
                    },
                });
            });
            $("#download").click(function () {
                $.ajax({
                    headers: {"X-CSRFToken": getCookie("csrftoken")},
                    type: "POST",
                    url: "/download/",
                    dataType: "json",
                    data: $("#update_info").serialize(),
                    success: function (param) {
                        var a = document.createElement('a');
                        var event = new MouseEvent('click');
                        a.download = param['detail'];
                        a.href = param['filename'];
                        console.log(a.href);
                        a.dispatchEvent(event);
                    },
                });
            })
        });
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            $().UItoTop({ easingType: 'easeOutQuart' });
        });
    </script>
	<script src="/src/js/filter/bootstrap.js"></script>
</body>
</html>
